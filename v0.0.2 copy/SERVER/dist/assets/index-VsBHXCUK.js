import{A as b,a as w,b as x,P as d,M as h,D as k,T as u,c as f,V as p,d as B,C,e as P,G as D,S as E,W as T,R as _,f as L}from"./three-F_QYV81H.js";import{l as z}from"./socket.io-client-IQIgtGCP.js";import"./engine.io-client-Uz0TRVm7.js";import"./engine.io-parser-33FB7g9V.js";import"./@socket.io-3-vkxHAM.js";import"./socket.io-parser-QJaHYohl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();class j{constructor(){this.listener=new b,this.audio=new w(this.listener)}init(t,n){var o=new x,i=new b,r=new w(i);o.load(t,function(s){r.setBuffer(s),r.setLoop(n===void 0?!1:n),r.play()})}}class I{constructor(){this.mouseButtonAction="punch",this.wannaJump=!1,this.hasTouchedGround=!1,this.hasJumped=!1,this.canDoubleJump=!1,this.hasDoubleJumped=!1,this.puncHoldTimer=0,this.punchCooldown=.25,this.sprite=null,this.size={width:.75,height:1},this.position={x:10,y:10,z:.01},this.collisions={left:!1,right:!1,top:!1,bottom:!1},this.velocity=3,this.airTime=0,this.goingLeft=!1,this.goingRight=!1,this.faceCollides=!1,this.facingDirection="",this.clickedElement=null,this.mouseX=0,this.mouseY=0,this.standingon=null,this.audioPlayer=null,this.punchedObjects=[]}create(t){console.log("Creating player");const n=new d(this.size.width,this.size.height),o=new h({side:k,map:new u().load("../Images/Player/player.png"),transparent:!0});let i=new f(n,o);i.position.x=this.position.x,i.position.y=this.position.y,i.position.z=this.position.z,i.renderOrder=100,i.name="Player",i.userData={objectType:"Player",name:t,dateCreated:Date.now()},this.audioPlayer=new j,this.sprite=i,this.name=t,e.player=this}setMousePosition(t){this.mouseX=-1+t.clientX/e.canvas.width*2,this.mouseY=1-t.clientY/e.canvas.height*2}jump(){if(this.airTime<3&&this.collisions.top===!1){if(e.delta===0)return;e.physics.gravityStrength=0,this.airTime+=e.delta,this.position.y+=(4-1*(this.airTime*this.airTime))*e.delta,this.airTime>2&&(this.hasJumped=!0,this.wannaJump=!1,e.physics.gravityStrength=1);return}}punch(){let t=new B;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.puncHoldTimer+=e.delta,this.getClickedElement(t),this.puncHoldTimer>this.punchCooldown&&(e.player.audioPlayer.init("../Audio/punch_block.wav",!1),console.log("Punching"),this.puncHoldTimer=0,this.clickedElement.userData.objectType==="Block"&&M(this.clickedElement))}place(){let t=new B;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getPlaceableTile(t),console.log("Placing"),this.clickedElement!==null&&this.clickedElement.userData.objectType==="Empty_Block"&&(this.audioPlayer.init("../Audio/break_block.wav",!1),this.clickedElement.userData.breakable=!0,this.clickedElement.userData.interactable=!0,this.clickedElement.userData.interactable_type="none",this.clickedElement.userData.objectType="Block",this.clickedElement.userData.sub_type="Solid Block",this.clickedElement.userData.punchCount=0,this.clickedElement.visible=!0,this.clickedElement.material.map=new u().load("../Images/Blocks/dirt.png"),this.clickedElement.userData.collides={top:!0,bottom:!0,left:!0,right:!0})}getClickedElement(t){e.raycaster.setFromCamera(t,e.camera);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let i=n[o].object;if(i.name==="Background"||i===void 0||(i.userData.objectType==="Block"&&(this.clickedElement=i),this.clickedElement===null))return;this.clickedElement.userData.objectType==="Empty_Block"&&i.userData.objectType==="Background Block"&&(this.clickedElement=i),console.log("bg or no bg",this.clickedElement)}}getPlaceableTile(t){e.raycaster.setFromCamera(t,e.camera);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let i=n[o].object;if(i.userData.objectType==="Empty_Block"){console.log("clicked",i),this.clickedElement=i;return}}}moveLeft(){this.goingLeft=!0,this.goingRight=!1,this.facingDirection=new p(-1,0,0),this.collisions.right=!1,e.physics.checkCollisionInPlayerWalkDirection(),this.collisions.left==!1&&(this.position.x-=this.velocity*e.delta)}moveRight(){e.player.facingDirection=new p(1,0,0),e.player.collisions.left=!1,e.physics.checkCollisionInPlayerWalkDirection(),e.player.collisions.right==!1&&(e.player.position.x+=e.player.velocity*e.delta)}standingOn(){let t=new p(this.position.x,this.position.y,this.position.z),n=new p(0,0,-1);e.raycaster.set(t,n);let o=e.raycaster.intersectObjects(e.scene.children);if(o!==void 0)for(let i=0;i<o.length;i++){let r=o[i].object;if(r===void 0)return;r.userData.sub_type==="Text"&&(this.standingon=r,console.log(r.userData.text))}}}function O(a){if(a.userData.punchCount===0){e.player.punchedObjects.push([a,Date.now()]);const n=new d(1,1),o=new h({color:new C(16711935),transparent:!0});o.map=new u().load("../Images/Breaking/breaking1.PNG");const i=new f(n,o);a.add(i)}a.userData.punchCount+=1;let t=Math.round(a.userData.punchCount/a.userData.hardness*100);t>20&&t<=40&&(a.children[0].material.map=new u().load("../Images/Breaking/breaking2.PNG")),t>40&&t<=60&&(a.children[0].material.map=new u().load("../Images/Breaking/breaking3.PNG")),t>60&&t<=80&&(a.children[0].material.map=new u().load("../Images/Breaking/breaking4.PNG")),t>80&&t<=100&&(a.children[0].material.map=new u().load("../Images/Breaking/breaking5.PNG"))}function A(a){e.player.audioPlayer.init("../Audio/break_block.wav",!1),a.remove(a.children[0]),a.userData.breakable=!1,a.userData.interactable=!1,a.userData.interactable_type="none",a.userData.objectType="Empty_Block",a.userData.sub_type="Empty_Block",a.userData.punchCount=0,a.material.map=new u().load("../Images/Blocks/transparent.png"),a.material.opacity=0,a.userData.collides={top:!1,bottom:!1,left:!1,right:!1}}function M(a){if(a.userData.breakable===!1){e.player.audioPlayer.init("../Audio/unbreakable.wav",!1),console.log("Not breakable");return}e.player.audioPlayer.init("../Audio/hit_block.wav",!1),O(a),a.userData.punchCount==a.userData.hardness&&A(a)}class R{constructor(){this.position={x:0,y:0,z:5},this.zoomingOut=!1,this.zoomingIn=!1}Camera(){const t=new P(75,window.innerWidth/window.innerHeight,.1,1e3);return t.position.x=this.position.x,t.position.y=this.position.y,t.position.z=this.position.z,t.name="Camera",t}}class S{constructor(){this.width=1,this.height=1}create(){const t=new d(this.width,this.height),n=new h({side:k,transparent:!0}),o=new f(t,n);return o.position.z=.001,o.name="Block",o}}let c={0:{name:"Empty_Block",texture:"../Images/Blocks/dirt.png",type:"Empty_Block",sub_type:"Empty_Block",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!1,interactable_type:"none"},1:{name:"Bedrock",texture:"../Images/Blocks/bedrock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!1,interactable:!1,interactable_type:"none"},2:{name:"Dirt",texture:"../Images/Blocks/dirt.png",alt_texture:"../Images/Blocks/dirt2.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},3:{name:"Rock",texture:"../Images/Blocks/rock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},4:{name:"Entry Portal",texture:"../Images/Blocks/entry-portal.png",type:"Block",sub_type:"Door",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!0,interactable_type:"click"},5:{name:"Sign",texture:"../Images/Blocks/sign.png",type:"Block",sub_type:"Text",hardness:3,punchCount:0,text:"Sample text",collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"click"},6:{name:"Radio",texture:"../Images/Blocks/radio.png",type:"Block",sub_type:"Music",hardness:10,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"punch"},7:{name:"Cave Background",texture:"../Images/Background blocks/cave_bg.png",type:"Background Block",sub_type:"Background",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!1,interactable_type:"none"}};class G{constructor(){this.width=1,this.height=1}create(t){const n=new d(this.width,this.height),o=new h({side:k,transparent:!0});t===0&&(o.opacity=0),t===7&&(o.map=new u().load(c[t].texture));const i=new f(n,o);return i.position.x=50,i.position.y=30,i.position.z=-1e-4,i.name="Background Block",i}}class J{constructor(){this.loaded=!1,this.startedloading=!1,this.dataIsLoaded=!1,this.width=100,this.height=56,this.entryPoint={x:0,y:0},this.blocks=[],this.backgroundBlocks=[]}unpackWorldDataAndThenLoad(t){for(let n=0;n<t.length;n++)e.world.blocks.push(t[n][0]),e.world.backgroundBlocks.push(t[n][1]);this.load()}load(){W(),X(this.blocks),N(this.backgroundBlocks),this.isLoaded=!0,e.player.position.x=this.entryPoint.x,e.player.position.y=this.entryPoint.y,e.scene.add(e.player.sprite)}}function W(){if(e.scene===void 0)return;const a=new d(105,65),t=new h({map:new u().load("../Images/background.png")}),n=new f(a,t);n.position.x=50,n.position.y=30,n.position.z=-1e-4,n.name="Background",e.scene.add(n)}function N(a){const t=new D;t.name="BackgroundBlockGroup";let n=0,o=0;for(let i=0;i<a.length;i++){const r=new G;let s=a[i],l=r.create(s);l.position.x=n,l.position.y=o,t.add(l),n+=1,n%e.world.width===0&&(n=0,o+=1)}e.scene.add(t)}function X(a){if(e.scene===void 0)return;const t=new D;t.name="BlockGroup";let n=0,o=0;for(let i=0;i<a.length;i++){const r=new S;let s=a[i],l=r.create(s);l.position.x=n,l.position.y=o,l.userData.hardness=c[s].hardness,l.userData.punchCount=c[s].punchCount,l.userData.breakable=c[s].breakable,l.userData.interactable=c[s].interactable,l.userData.interactable_type=c[s].interactable_type,l.material.map=new u().load(c[s].texture),l.userData.objectType=c[s].type,l.userData.sub_type=c[s].sub_type,l.userData.collides=c[s].collides,c[s].sub_type==="Text"&&(l.userData.text=c[s].text),s===4&&(e.world.entryPoint.x=n,e.world.entryPoint.y=o),s===0&&(l.visible=!1),t.add(l),n+=1,n%e.world.width===0&&(n=0,o+=1),e.scene.add(t)}}class Y{constructor(){this.gravityStrength=1}update(){e.player===void 0||e.player===null||(q(),!e.player.collisions.bottom&&e.player.wannaJump===!1&&(e.player.position.y-=.2+e.physics.gravityStrength*(e.player.airTime*e.player.airTime)*e.delta),e.player.collisions.bottom&&(e.player.position.y<4&&(e.player.position.y=4),e.player.position.y=Math.round(e.player.position.y)))}checkCollisionInPlayerWalkDirection(){if(e.player.sprite===void 0||e.player.sprite===null||e.player.facingDirection==="")return;let t=new p(0,0,e.player.position.z);t.x+=e.player.position.x+.26*e.player.facingDirection.x,t.y+=e.player.position.y;let n=new p(0,0,-1);if(e.raycaster.set(t,n),e.world.isLoaded===!1)return;let o=e.raycaster.intersectObjects(e.scene.children);if(o!==void 0)for(let i=0;i<o.length;i++){let r=o[i].object;if(r===void 0||r.userData.collides===void 0)return;if(r.userData.objectType==="Block"){if(console.log(e.player.facingDirection.x),e.player.facingDirection.x==1&&(console.log("Checking collision right"),console.log(r),r.userData.collides.left===!0)){e.player.collisions.right=!0,e.player.collisions.left=!1;return}if(e.player.facingDirection.x==-1&&(console.log("Checking collision left"),console.log(r),r.userData.collides.right===!0)){e.player.collisions.left=!0,e.player.collisions.right=!1;return}}}}}function q(){if(e.world.isLoaded===!1){e.player.collisions.bottom=!0;return}let a=new p(e.player.position.x,e.player.position.y-e.player.size.height/2-.01,e.player.position.z),t=new p(0,0,-1);e.raycaster.set(a,t);let n=e.raycaster.intersectObjects(e.scene.children);if(n===void 0||n.length===0)return;let o=[];for(let i=0;i<n.length;i++){let r=n[i].object;if(r===void 0)return;r.name==="Block"&&o.push(e.scene.getObjectById(r.id))}if(o!==void 0){if(o.length>0)for(let i=0;i<o.length;i++){let r=o[i];if(r===void 0)return;if(r.userData.objectType==="Block"&&r.userData.collides.top===!0){e.player.hasTouchedGround=!0,e.player.collisions.bottom=!0,e.player.airTime=0;return}}e.player.collisions.bottom=!1,e.player.airTime+=e.delta}}const y=new E,m=new T;m.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(m.domElement);let v=document.querySelector("canvas");const H=new L,F=new I;var e;let V="http://localhost:3069";class U{constructor(){this.game=null,this.canvas=v,this.delta=0,this.server=null,this.connected=!1}init(){const t=new Y;this.physics=t;const n=new R;this.camera=n.Camera();const o=new _;this.raycaster=o;const i=z(V);this.server=i,this.world=new J,this.scene=y,y.add(this.camera),e.server.on("connect",()=>{console.log("connected"),e.connected=!0,e.server.on("returnWorld",r=>{console.log(r),F.create("@dev"),e.world.unpackWorldDataAndThenLoad(r)})}),g()}}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("request-world-data",()=>{console.log("req world");let t=document.getElementById("worldname-input").value;console.log(t),e.server.emit("getWorld",t)}),e=new U,e.game=e,console.log(e),e.init()});document.addEventListener("keydown",a=>{let t=a.key.toUpperCase();if(t==="W"||t===" "){if(e.physics.gravityStrength===0)return;e.physics.gravityStrength=0,e.player.jump(),e.player.wannaJump=!0}t==="D"&&(e.player.facingDirection=new p(1,0,0),e.player.goingRight=!0),t==="A"&&(e.player.facingDirection=new p(-1,0,0),e.player.goingLeft=!0),t==="S"&&(e.player.position.y-=1),t==="X"&&(e.camera.zoomingOut=!0),t==="Z"&&(e.camera.zoomingIn=!0)});document.addEventListener("keyup",a=>{let t=a.key.toUpperCase();if((t==="W"||t===" ")&&(e.player.wannaJump=!1,e.player.hasJumped=!1,e.physics.gravityStrength=1,e.player.airTime=0),t==="P"){if(e.player.mouseButtonAction==="punch"){e.player.mouseButtonAction="place",console.log("place");return}if(e.player.mouseButtonAction==="place"){e.player.mouseButtonAction="punch",console.log("punch");return}}t==="D"&&(e.player.goingRight=!1),t==="A"&&(e.player.goingLeft=!1),t==="X"&&(e.camera.zoomingOut=!1),t==="Z"&&(e.camera.zoomingIn=!1)});v.addEventListener("pointermove",a=>{e.player!==void 0&&e.player.setMousePosition(a)});document.addEventListener("pointerdown",a=>{e.player!==void 0&&(e.player.holdingMouseRight=!0)});document.addEventListener("pointerup",a=>{e.player!==void 0&&(e.player.holdingMouseRight=!1)});function g(){if(e.delta=H.getDelta(),!e.world.isLoaded||e.player===void 0){requestAnimationFrame(g),m.render(y,e.camera);return}if(e.physics.update(),e.player.goingRight&&e.player.position.x<99.25&&e.player.moveRight(),e.player.goingLeft&&e.player.position.x>-.1&&e.player.moveLeft(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="punch"&&e.player.punch(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="place"&&e.player.place(),e.player.wannaJump){if(e.player.canDoubleJump===!1&&e.player.hasTouchedGround===!1&&e.player.hasJumped===!0)return;e.player.jump()}e.camera.zoomingIn===!0&&(console.log(e.camera.position.z),e.camera.position.z>2&&(e.camera.position.z-=5*e.delta)),e.camera.zoomingOut===!0&&(console.log(e.camera.position.z),e.camera.position.z<12&&(e.camera.position.z+=5*e.delta)),e.camera.position.x=e.player.position.x,e.camera.position.y=e.player.position.y,e.player.sprite.position.x=e.player.position.x,e.player.sprite.position.y=e.player.position.y,e.player.standingOn(),requestAnimationFrame(g),m.render(y,e.camera)}
