import{A as k,a as w,b as T,P as d,M as h,D as b,T as p,c as y,V as u,d as B,e as E,G as v,S as _,W as x,R as j,C as P}from"./three-_TeBfzqJ.js";import{l as L}from"./socket.io-client-IQIgtGCP.js";import"./engine.io-client-Uz0TRVm7.js";import"./engine.io-parser-33FB7g9V.js";import"./@socket.io-3-vkxHAM.js";import"./socket.io-parser-QJaHYohl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();class z{constructor(){this.listener=new k,this.audio=new w(this.listener)}init(t,n){var o=new T,a=new k,s=new w(a);o.load(t,function(r){s.setBuffer(r),s.setLoop(n===void 0?!1:n),s.play()})}}class O{constructor(){this.mouseButtonAction="punch",this.wannaJump=!1,this.jumping=!1,this.hasTouchedGround=!1,this.hasJumped=!1,this.canDoubleJump=!1,this.hasDoubleJumped=!1,this.puncHoldTimer=0,this.punchCooldown=.25,this.sprite=null,this.size={width:.75,height:1},this.position={x:10,y:10,z:.01},this.collisions={left:!1,right:!1,top:!1,bottom:!1},this.velocity=3,this.airTime=0,this.goingLeft=!1,this.goingRight=!1,this.faceCollides=!1,this.facingDirection="",this.clickedElement=null,this.mouseX=0,this.mouseY=0,this.standingon=null,this.audioPlayer=null,this.punchedObjects=[]}create(t){console.log("Creating player");const n=new d(this.size.width,this.size.height),o=new h({side:b,map:new p().load("../Images/Player/player.png"),transparent:!0});let a=new y(n,o);a.position.x=this.position.x,a.position.y=this.position.y,a.position.z=this.position.z,a.renderOrder=100,a.name="Player",a.userData={objectType:"Player",name:t,dateCreated:Date.now()},this.audioPlayer=new z,this.sprite=a,this.name=t,e.player=this}setMousePosition(t){this.mouseX=-1+t.clientX/e.canvas.width*2,this.mouseY=1-t.clientY/e.canvas.height*2}jump(){if(this.airTime<3&&this.collisions.top===!1&&this.hasJumped===!1){if(e.delta===0)return;this.jumping=!0,this.airTime+=e.delta,this.position.y+=(4-1*(this.airTime*this.airTime))*e.delta,this.airTime>2&&(this.airTime=0,this.hasJumped=!0,e.physics.gravityStrength=1);return}this.collisions.top===!0&&(this.jumping=!1,this.airTime=0,this.hasJumped=!0,e.physics.gravityStrength=1)}punch(){let t=new B;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.puncHoldTimer+=e.delta,this.getClickedElement(t),this.puncHoldTimer>this.punchCooldown&&(e.player.audioPlayer.init("../Audio/punch_block.wav",!1),this.puncHoldTimer=0,this.clickedElement.userData.objectType==="Block"&&(console.log(this.clickedElement),D(this.clickedElement)),this.clickedElement.userData.objectType==="Background Block"&&(console.log("background punched!"),console.log(this.clickedElement.userData),D(this.clickedElement)))}place(){let t=new B;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getPlaceableTile(t),console.log("Placing"),this.clickedElement!==null&&this.clickedElement.userData.objectType==="Empty_Block"&&(this.audioPlayer.init("../Audio/break_block.wav",!1),this.clickedElement.userData.breakable=!0,this.clickedElement.userData.interactable=!0,this.clickedElement.userData.interactable_type="none",this.clickedElement.userData.objectType="Block",this.clickedElement.userData.sub_type="Solid Block",this.clickedElement.userData.punchCount=0,this.clickedElement.material.visible=!0,this.clickedElement.material.map=new p().load("../Images/Blocks/dirt.png"),this.clickedElement.userData.collides={top:!0,bottom:!0,left:!0,right:!0})}plant(){this.clickedElement!==null&&this.clickedElement.userData.objectType==="Empty_Block"&&console.log("planting!")}getClickedElement(t){var n=!1;e.raycaster.setFromCamera(t,e.camera);let o=e.raycaster.intersectObjects(e.scene.children);for(let a=0;a<o.length;a++){let s=o[a].object;if(s===void 0||(s.userData.objectType==="Empty_Block"&&(n=!0),s.userData.objectType==="Block"&&(this.clickedElement=s),this.clickedElement===null))return;n===!0&&s.userData.objectType==="Background Block"&&(this.clickedElement=s)}}getPlaceableTile(t){e.raycaster.setFromCamera(t,e.camera);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let a=n[o].object;if(a.userData.objectType==="Empty_Block"){console.log("clicked",a),this.clickedElement=a;return}}}moveLeft(){this.goingLeft=!0,this.goingRight=!1,this.collisions.left===!1&&(this.position.x-=this.velocity*e.delta)}moveRight(){e.player.collisions.right===!1&&(e.player.position.x+=e.player.velocity*e.delta)}standingOn(){let t=new u(this.position.x,this.position.y,this.position.z),n=new u(0,0,-1);e.raycaster.set(t,n);let o=e.raycaster.intersectObjects(e.scene.children);if(o!==void 0)for(let a=0;a<o.length;a++){let s=o[a].object;if(s===void 0)return;s.userData.sub_type==="Text"&&(this.standingon=s)}}}function A(i){if(i.userData.punchCount===0){e.player.punchedObjects.push([i,Date.now()]);const n=new d(1,1),o=new h({transparent:!0});o.map=new p().load("../Images/Breaking/breaking1.PNG");const a=new y(n,o);i.add(a)}i.userData.punchCount+=1;let t=Math.round(i.userData.punchCount/i.userData.hardness*100);t>20&&t<=40&&(i.children[0].material.map=new p().load("../Images/Breaking/breaking2.PNG")),t>40&&t<=60&&(i.children[0].material.map=new p().load("../Images/Breaking/breaking3.PNG")),t>60&&t<=80&&(i.children[0].material.map=new p().load("../Images/Breaking/breaking4.PNG")),t>80&&t<=100&&(i.children[0].material.map=new p().load("../Images/Breaking/breaking5.PNG"))}function M(i){e.player.audioPlayer.init("../Audio/break_block.wav",!1),i.remove(i.children[0]),i.userData.breakable=!1,i.userData.interactable=!1,i.userData.interactable_type="none",i.userData.objectType==="Block"&&(i.userData.objectType="Empty_Block"),i.userData.objectType==="Background Block"&&(i.userData.objectType="Empty_Background_Block"),i.userData.punchCount=0,i.material.map=new p().load("../Images/Blocks/transparent.png"),i.material.visible=!1,i.userData.collides={top:!1,bottom:!1,left:!1,right:!1}}function D(i){if(i.userData.breakable===!1){e.player.audioPlayer.init("../Audio/unbreakable.wav",!1);return}e.player.audioPlayer.init("../Audio/hit_block.wav",!1),A(i),i.userData.punchCount==i.userData.hardness&&M(i)}class R{constructor(){this.position={x:0,y:0,z:5},this.zoomingOut=!1,this.zoomingIn=!1}Camera(){const t=new E(75,window.innerWidth/window.innerHeight,.1,1e3);return t.position.x=this.position.x,t.position.y=this.position.y,t.position.z=this.position.z,t.name="Camera",t}}class S{constructor(){this.width=1,this.height=1}create(){const t=new d(this.width,this.height),n=new h({side:b,transparent:!0}),o=new y(t,n);return o.position.z=.001,o.name="Block",o}}let l={0:{name:"Empty_Block",texture:"../Images/Blocks/dirt.png",type:"Empty_Block",sub_type:"Empty_Block",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!1,interactable_type:"none"},1:{name:"Bedrock",texture:"../Images/Blocks/bedrock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!1,interactable:!1,interactable_type:"none"},2:{name:"Dirt",texture:"../Images/Blocks/dirt.png",alt_texture:"../Images/Blocks/dirt2.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},3:{name:"Rock",texture:"../Images/Blocks/rock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},4:{name:"Entry Portal",texture:"../Images/Blocks/entry-portal.png",type:"Block",sub_type:"Door",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!0,interactable_type:"click"},5:{name:"Sign",texture:"../Images/Blocks/sign.png",type:"Block",sub_type:"Text",hardness:3,punchCount:0,text:"Sample text",collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"click"},6:{name:"Radio",texture:"../Images/Blocks/radio.png",type:"Block",sub_type:"Music",hardness:10,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"punch"},7:{name:"Cave Background",texture:"../Images/Background blocks/cave_bg.png",type:"Background Block",sub_type:"Background",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!1,interactable_type:"none"}};class I{constructor(){this.width=1,this.height=1}create(t){const n=new d(this.width,this.height),o=new h({side:b,transparent:!0}),a=new y(n,o);return t===0&&(o.opacity=0,a.userData.hardness=3,a.userData.punchCount=0,a.userData.breakable=!1,a.userData.interactable="false",a.userData.interactable_type="none",a.userData.objectType="Empty_Background_Block",a.userData.sub_type="Background",a.userData.collides={top:!1,bottom:!1,left:!1,right:!1}),t===7&&(o.map=new p().load(l[t].texture),a.userData.hardness=l[t].hardness,a.userData.punchCount=l[t].punchCount,a.userData.breakable=l[t].breakable,a.userData.interactable=l[t].interactable,a.userData.interactable_type=l[t].interactable_type,a.userData.objectType=l[t].type,a.userData.sub_type=l[t].sub_type,a.userData.collides=l[t].collides),a.position.x=50,a.position.y=30,a.position.z=-1e-4,a.name="Background Block",a}}class G{constructor(){this.loaded=!1,this.startedloading=!1,this.dataIsLoaded=!1,this.width=100,this.height=56,this.entryPoint={x:0,y:0},this.blocks=[],this.backgroundBlocks=[]}unpackWorldDataAndThenLoad(t){for(let n=0;n<t.length;n++)e.world.blocks.push(t[n][0]),e.world.backgroundBlocks.push(t[n][1]);this.load()}load(){J(),N(this.blocks),W(this.backgroundBlocks),this.isLoaded=!0,e.player.position.x=this.entryPoint.x,e.player.position.y=this.entryPoint.y,e.scene.add(e.player.sprite)}}function J(){if(e.scene===void 0)return;const i=new d(105,65),t=new h({map:new p().load("../Images/background.png")}),n=new y(i,t);n.position.x=50,n.position.y=30,n.position.z=-1e-4,n.name="Background",e.scene.add(n)}function W(i){const t=new v;t.name="BackgroundBlockGroup";let n=0,o=0;for(let a=0;a<i.length;a++){const s=new I;let r=i[a],c=s.create(r);c.position.x=n,c.position.y=o,t.add(c),n+=1,n%e.world.width===0&&(n=0,o+=1)}e.scene.add(t)}function N(i){if(e.scene===void 0)return;const t=new v;t.name="BlockGroup";let n=0,o=0;for(let a=0;a<i.length;a++){const s=new S;let r=i[a],c=s.create(r);c.position.x=n,c.position.y=o,c.userData.hardness=l[r].hardness,c.userData.punchCount=l[r].punchCount,c.userData.breakable=l[r].breakable,c.userData.interactable=l[r].interactable,c.userData.interactable_type=l[r].interactable_type,c.material.map=new p().load(l[r].texture),c.userData.objectType=l[r].type,c.userData.sub_type=l[r].sub_type,c.userData.collides=l[r].collides,l[r].sub_type==="Text"&&(c.userData.text=l[r].text),r===4&&(e.world.entryPoint.x=n,e.world.entryPoint.y=o),r===0&&(c.material.visible=!1),t.add(c),n+=1,n%e.world.width===0&&(n=0,o+=1),e.scene.add(t)}}class X{constructor(){this.gravityStrength=1}update(){e.player===void 0||e.player===null||(F(),H(),Y(),q(),!e.player.collisions.bottom&&e.player.jumping===!1&&(e.player.position.y-=.2+e.physics.gravityStrength*(e.player.airTime*e.player.airTime)*e.delta),e.player.collisions.bottom&&(e.player.position.y<4&&(e.player.position.y=4),e.player.position.y=Math.round(e.player.position.y)))}}function Y(){if(e.world.isLoaded===!1)return;let i=new u(e.player.position.x-e.player.size.width/2,e.player.position.y,e.player.position.z),t=new u(0,0,-1);e.raycaster.set(i,t);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let a=n[o].object;if(a.userData.objectType==="Block"&&a.userData.collides.right===!0){e.player.collisions.left=!0;return}e.player.collisions.left=!1}}function q(){if(e.world.isLoaded===!1)return;let i=new u(e.player.position.x+e.player.size.width/2,e.player.position.y,e.player.position.z),t=new u(0,0,-1);e.raycaster.set(i,t);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let a=n[o].object;if(a.userData.objectType==="Block"){a.userData.collides.left===!0&&(e.player.collisions.right=!0);return}}e.player.collisions.right=!1}function H(){if(e.world.isLoaded===!1){e.player.collisions.bottom=!0;return}let i=new u(e.player.position.x,e.player.position.y-e.player.size.height/2,e.player.position.z),t=new u(0,0,-1);e.raycaster.set(i,t);let n=e.raycaster.intersectObjects(e.scene.children);if(n===void 0||n.length===0)return;let o=[];for(let a=0;a<n.length;a++){let s=n[a].object;if(s===void 0)return;s.name==="Block"&&o.push(e.scene.getObjectById(s.id))}if(o!==void 0){if(o.length>0)for(let a=0;a<o.length;a++){let s=o[a];if(s===void 0)return;if(s.userData.objectType==="Block"&&s.userData.collides.top===!0){e.player.hasTouchedGround=!0,e.player.collisions.bottom=!0,e.player.airTime=0;return}}e.player.collisions.bottom=!1,e.player.airTime+=e.delta}}function F(){if(e.world.isLoaded===!1)return;let i=new u(e.player.position.x,e.player.position.y+e.player.size.height/2,e.player.position.z),t=new u(0,0,-1);e.raycaster.set(i,t);let n=e.raycaster.intersectObjects(e.scene.children);for(let o=0;o<n.length;o++){let a=n[o].object;if(a.userData.objectType==="Block"){a.userData.collides.bottom===!0&&(e.player.collisions.top=!0);return}}e.player.collisions.top=!1}const f=new _,m=new x;m.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(m.domElement);let C=document.querySelector("canvas");const V=new P,U=new O;var e;let Z="http://localhost:3069";class K{constructor(){this.game=null,this.canvas=C,this.delta=0,this.server=null,this.connected=!1}init(){const t=new X;this.physics=t;const n=new R;this.camera=n.Camera();const o=new j;this.raycaster=o;const a=L(Z);this.server=a,this.world=new G,this.scene=f,f.add(this.camera),e.server.on("connect",()=>{console.log("connected"),e.connected=!0,e.server.on("returnWorld",s=>{console.log(s),U.create("@dev"),e.world.unpackWorldDataAndThenLoad(s)})}),g()}}document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("request-world-data",()=>{console.log("req world");let t=document.getElementById("worldname-input").value;console.log(t),e.server.emit("getWorld",t)}),e=new K,e.game=e,console.log(e),e.init()});document.addEventListener("keydown",i=>{let t=i.key.toUpperCase();(t==="W"||t===" ")&&e.player.wannaJump===!1&&(e.physics.gravityStrength=0,e.player.wannaJump=!0),t==="D"&&(e.player.facingDirection=new u(1,0,0),e.player.goingRight=!0),t==="A"&&(e.player.facingDirection=new u(-1,0,0),e.player.goingLeft=!0),t==="S"&&(e.player.position.y-=1),t==="X"&&(e.camera.zoomingOut=!0),t==="Z"&&(e.camera.zoomingIn=!0)});document.addEventListener("keyup",i=>{let t=i.key.toUpperCase();if((t==="W"||t===" ")&&(e.player.jumping=!1,e.player.wannaJump=!1,e.player.hasJumped=!1,e.physics.gravityStrength=1,e.player.airTime=0),t==="P"){if(e.player.mouseButtonAction==="punch"){e.player.mouseButtonAction="place",console.log("place");return}if(e.player.mouseButtonAction==="place"){e.player.mouseButtonAction="plant",console.log("plant");return}if(e.player.mouseButtonAction==="plant"){e.player.mouseButtonAction="punch",console.log("punch");return}}t==="D"&&(e.player.goingRight=!1),t==="A"&&(e.player.goingLeft=!1),t==="X"&&(e.camera.zoomingOut=!1),t==="Z"&&(e.camera.zoomingIn=!1)});C.addEventListener("pointermove",i=>{e.player!==void 0&&e.player.setMousePosition(i)});document.addEventListener("pointerdown",i=>{e.player!==void 0&&(e.player.holdingMouseRight=!0)});document.addEventListener("pointerup",i=>{e.player!==void 0&&(e.player.holdingMouseRight=!1)});function g(){if(e.delta=V.getDelta(),!e.world.isLoaded||e.player===void 0){requestAnimationFrame(g),m.render(f,e.camera);return}e.physics.update(),e.player.goingRight&&e.player.position.x<99.25&&e.player.moveRight(),e.player.goingLeft&&e.player.position.x>-.1&&e.player.moveLeft(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="punch"&&e.player.punch(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="place"&&e.player.place(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="plant"&&e.player.plant(),e.player.wannaJump&&(e.player.hasJumped===!1&&e.player.jump(),e.player.hasJumped===!0&&(e.player.jumping=!1)),e.camera.zoomingIn===!0&&(console.log(e.camera.position.z),e.camera.position.z>2&&(e.camera.position.z-=5*e.delta)),e.camera.zoomingOut===!0&&(console.log(e.camera.position.z),e.camera.position.z<12&&(e.camera.position.z+=5*e.delta)),e.camera.position.x=e.player.position.x,e.camera.position.y=e.player.position.y,e.player.sprite.position.x=e.player.position.x,e.player.sprite.position.y=e.player.position.y,e.player.standingOn(),requestAnimationFrame(g),m.render(f,e.camera)}
