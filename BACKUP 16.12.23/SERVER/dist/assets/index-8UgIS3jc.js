import{A as k,a as b,b as E,P as y,M as f,D as B,T as p,c as m,V as u,d as w,e as v,G as D,S as C,W as P,R as T,C as _}from"./three-_TeBfzqJ.js";import{l as L}from"./socket.io-client-IQIgtGCP.js";import"./engine.io-client-Uz0TRVm7.js";import"./engine.io-parser-33FB7g9V.js";import"./@socket.io-3-vkxHAM.js";import"./socket.io-parser-QJaHYohl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();class z{constructor(){this.listener=new k,this.audio=new b(this.listener)}init(t,o){var a=new E,i=new k,n=new b(i);a.load(t,function(l){n.setBuffer(l),n.setLoop(o===void 0?!1:o),n.play()})}}class I{constructor(){this.mouseButtonAction="punch",this.wannaJump=!1,this.hasTouchedGround=!1,this.hasJumped=!1,this.canDoubleJump=!1,this.hasDoubleJumped=!1,this.puncHoldTimer=0,this.punchCooldown=.25,this.sprite=null,this.size={width:.75,height:1},this.position={x:0,y:0,z:.01},this.collisions={left:!1,right:!1,top:!1,bottom:!1},this.velocity=3,this.airTime=0,this.goingLeft=!1,this.goingRight=!1,this.faceCollides=!1,this.facingDirection="",this.clickedElement=null,this.mouseX=0,this.mouseY=0,this.standingon=null,this.audioPlayer=null}create(t){console.log("Creating player");const o=new y(this.size.width,this.size.height),a=new f({side:B,map:new p().load("../Images/Player/player.png"),transparent:!0});let i=new m(o,a);i.position.x=this.position.x,i.position.y=this.position.y,i.position.z=this.position.z,i.renderOrder=100,i.name="Player",i.userData={objectType:"Player",name:t,dateCreated:Date.now()},this.audioPlayer=new z,this.sprite=i,this.name=t,e.player=this}setMousePosition(t){this.mouseX=-1+t.clientX/e.canvas.width*2,this.mouseY=1-t.clientY/e.canvas.height*2}jump(){if(this.airTime<3&&this.collisions.top===!1){if(e.delta===0)return;e.physics.gravityStrength=0,this.airTime+=e.delta,this.position.y+=(4-1*(this.airTime*this.airTime))*e.delta,this.airTime>2&&(this.hasJumped=!0,this.wannaJump=!1,e.physics.gravityStrength=1);return}}punch(){let t=new w;if(t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.puncHoldTimer+=e.delta,this.getClickedElement(t),this.puncHoldTimer>this.punchCooldown&&(this.audioPlayer.init("../Audio/punch_block.wav",!1),console.log("Punching"),this.puncHoldTimer=0,this.clickedElement.userData.objectType==="Block")){if(console.log(this.clickedElement.userData),this.clickedElement.userData.breakable===!1){this.audioPlayer.init("../Audio/unbreakable.wav",!1),console.log("Not breakable");return}this.audioPlayer.init("../Audio/hit_block.wav",!1),this.clickedElement.userData.punchCount+=1,console.log(this.clickedElement.userData),this.clickedElement.userData.punchCount==this.clickedElement.userData.hardness&&(this.audioPlayer.init("../Audio/break_block.wav",!1),this.clickedElement.userData.breakable=!1,this.clickedElement.userData.interactable=!1,this.clickedElement.userData.interactable_type="none",this.clickedElement.userData.objectType="Empty_Block",this.clickedElement.userData.sub_type="Empty_Block",this.clickedElement.userData.punchCount=0,this.clickedElement.material.map=new p().load("../Images/Blocks/transparent.png"),this.clickedElement.material.opacity=0,this.clickedElement.userData.collides={top:!1,bottom:!1,left:!1,right:!1})}}place(){let t=new w;t.x=this.mouseX-.1,t.y=this.mouseY-.1,this.getPlaceableTile(t),console.log("Placing"),this.clickedElement!==null&&this.clickedElement.userData.objectType==="Empty_Block"&&(this.audioPlayer.init("../Audio/break_block.wav",!1),this.clickedElement.userData.breakable=!0,this.clickedElement.userData.interactable=!0,this.clickedElement.userData.interactable_type="none",this.clickedElement.userData.objectType="Block",this.clickedElement.userData.sub_type="Solid Block",this.clickedElement.userData.punchCount=0,this.clickedElement.visible=!0,this.clickedElement.material.map=new p().load("../Images/Blocks/dirt.png"),this.clickedElement.userData.collides={top:!0,bottom:!0,left:!0,right:!0})}getClickedElement(t){e.raycaster.setFromCamera(t,e.camera);let o=e.raycaster.intersectObjects(e.scene.children);for(let a=0;a<o.length;a++){let i=o[a].object;if(i.name==="Background"||i===void 0)return;i.name==="Block"&&(this.clickedElement=i)}}getPlaceableTile(t){e.raycaster.setFromCamera(t,e.camera);let o=e.raycaster.intersectObjects(e.scene.children);for(let a=0;a<o.length;a++){let i=o[a].object;if(i.userData.objectType==="Empty_Block"){console.log("clicked",i),this.clickedElement=i;return}}}moveLeft(){this.goingLeft=!0,this.goingRight=!1,this.facingDirection=new u(-1,0,0),this.collisions.right=!1,e.physics.checkCollisionInPlayerWalkDirection(),this.collisions.left==!1&&(this.position.x-=this.velocity*e.delta)}moveRight(){e.player.facingDirection=new u(1,0,0),e.player.collisions.left=!1,e.physics.checkCollisionInPlayerWalkDirection(),e.player.collisions.right==!1&&(e.player.position.x+=e.player.velocity*e.delta)}standingOn(){let t=new u(this.position.x,this.position.y,this.position.z),o=new u(0,0,-1);e.raycaster.set(t,o);let a=e.raycaster.intersectObjects(e.scene.children);if(a!==void 0)for(let i=0;i<a.length;i++){let n=a[i].object;if(n===void 0)return;n.userData.sub_type==="Text"&&(this.standingon=n,console.log(n.userData.text))}}}class j{constructor(){this.position={x:0,y:0,z:5},this.zoomingOut=!1,this.zoomingIn=!1}Camera(){const t=new v(75,window.innerWidth/window.innerHeight,.1,1e3);return t.position.x=this.position.x,t.position.y=this.position.y,t.position.z=this.position.z,t.name="Camera",t}}class A{constructor(){this.width=1,this.height=1}create(t){const o=new y(this.width,this.height),a=new f({side:B,transparent:!0}),i=new m(o,a);return i.position.z=.001,i.name="Block",i}}let c={0:{name:"Empty_Block",texture:"../Images/Blocks/dirt.png",type:"Empty_Block",sub_type:"Empty_Block",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!1,interactable_type:"none"},1:{name:"Bedrock",texture:"../Images/Blocks/bedrock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!1,interactable:!1,interactable_type:"none"},2:{name:"Dirt",texture:"../Images/Blocks/dirt.png",alt_texture:"../Images/Blocks/dirt2.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},3:{name:"Rock",texture:"../Images/Blocks/rock.png",type:"Block",sub_type:"Solid Block",hardness:3,punchCount:0,collides:{top:!0,bottom:!0,left:!0,right:!0},breakable:!0,interactable:!1,interactable_type:"none"},4:{name:"Entry Portal",texture:"../Images/Blocks/entry-portal.png",type:"Block",sub_type:"Door",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!1,interactable:!0,interactable_type:"click"},5:{name:"Sign",texture:"../Images/Blocks/sign.png",type:"Block",sub_type:"Text",hardness:3,punchCount:0,text:"Sample text",collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"click"},6:{name:"Radio",texture:"../Images/Blocks/radio.png",type:"Block",sub_type:"Music",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!0,interactable_type:"punch"},7:{name:"Cave Background",texture:"../Images/Background blocks/rock.png",type:"Background Block",sub_type:"Background",hardness:3,punchCount:0,collides:{top:!1,bottom:!1,left:!1,right:!1},breakable:!0,interactable:!1,interactable_type:"none"}};class O{constructor(){this.width=1,this.height=1}create(t){const o=new y(this.width,this.height),a=new f({map:new p().load(c[t].texture)}),i=new m(o,a);return i.position.x=50,i.position.y=30,i.position.z=-1e-4,i.name="Background Block",i}}class S{constructor(){this.loaded=!1,this.startedloading=!1,this.dataIsLoaded=!1,this.width=100,this.height=56,this.entryPoint={x:0,y:0},this.blocks=[],this.backgroundBlocks=[]}unpackWorldDataAndThenLoad(t){for(let o=0;o<t.length;o++)e.world.blocks.push(t[o][0]),e.world.backgroundBlocks.push(t[o][1]);console.log("World data unpacked",e.world.blocks,e.world.backgroundBlocks)}load(){R(),W(this.blocks),M(this.backgroundBlocks),this.isLoaded=!0,console.log("World loaded",this.entryPoint.x,this.entryPoint.y),e.player.position.x=this.entryPoint.x,e.player.position.y=this.entryPoint.y,e.scene.add(e.player.sprite)}}function R(){if(e.scene===void 0)return;const s=new y(105,65),t=new f({map:new p().load("../Images/background.png")}),o=new m(s,t);o.position.x=50,o.position.y=30,o.position.z=-1e-4,o.name="Background",e.scene.add(o)}function M(s){const t=new D;t.name="BackgroundBlockGroup";let o=0,a=0;for(let i=0;i<s.length;i++){const n=new O;let l=s[i],r=n.create(l);r.position.x=o,r.position.y=a,t.add(r),o+=1,o%e.world.width===0&&(o=0,a+=1)}e.scene.add(t)}function W(s){if(e.scene===void 0)return;const t=new D;t.name="BlockGroup";let o=0,a=0;for(let i=0;i<s.length;i++){const n=new A;let l=s[i],r=n.create(l);r.position.x=o,r.position.y=a,r.userData.hardness=c[l].hardness,r.userData.punchCount=c[l].punchCount,r.userData.breakable=c[l].breakable,r.userData.interactable=c[l].interactable,r.userData.interactable_type=c[l].interactable_type,r.material.map=new p().load(c[l].texture),r.userData.objectType=c[l].type,r.userData.sub_type=c[l].sub_type,r.userData.collides=c[l].collides,c[l].sub_type==="Text"&&(r.userData.text=c[l].text),l===4&&(console.log("Entry point found"),e.world.entryPoint.x=o,e.world.entryPoint.y=a),l===0&&(r.visible=!1),t.add(r),o+=1,o%e.world.width===0&&(o=0,a+=1),e.scene.add(t)}}class J{constructor(){this.gravityStrength=1}update(){e.player===void 0||e.player===null||(G(),!e.player.collisions.bottom&&e.player.wannaJump===!1&&(e.player.position.y-=.2+e.physics.gravityStrength*(e.player.airTime*e.player.airTime)*e.delta),e.player.collisions.bottom&&(e.player.position.y<4&&(e.player.position.y=4),e.player.position.y=Math.round(e.player.position.y)))}checkCollisionInPlayerWalkDirection(){if(e.player.sprite===void 0||e.player.sprite===null||e.player.facingDirection==="")return;let t=new u(0,0,e.player.position.z);t.x+=e.player.position.x+.26*e.player.facingDirection.x,t.y+=e.player.position.y;let o=new u(0,0,-1);if(e.raycaster.set(t,o),e.world.isLoaded===!1)return;let a=e.raycaster.intersectObjects(e.scene.children);if(a!==void 0)for(let i=0;i<a.length;i++){let n=a[i].object;if(n===void 0||n.userData.collides===void 0)return;if(n.userData.objectType==="Block"){if(console.log(e.player.facingDirection.x),e.player.facingDirection.x==1&&(console.log("Checking collision right"),console.log(n),n.userData.collides.left===!0)){e.player.collisions.right=!0,e.player.collisions.left=!1;return}if(e.player.facingDirection.x==-1&&(console.log("Checking collision left"),console.log(n),n.userData.collides.right===!0)){e.player.collisions.left=!0,e.player.collisions.right=!1;return}}}}}function G(){if(e.world.isLoaded===!1){e.player.collisions.bottom=!0;return}let s=new u(e.player.position.x,e.player.position.y-e.player.size.height/2-.01,e.player.position.z),t=new u(0,0,-1);e.raycaster.set(s,t);let o=e.raycaster.intersectObjects(e.scene.children);if(o===void 0||o.length===0)return;let a=[];for(let i=0;i<o.length;i++){let n=o[i].object;if(n===void 0)return;n.name==="Block"&&a.push(e.scene.getObjectById(n.id))}if(a!==void 0){if(a.length>0)for(let i=0;i<a.length;i++){let n=a[i];if(n===void 0)return;if(n.userData.objectType==="Block"&&n.userData.collides.top===!0){e.player.hasTouchedGround=!0,e.player.collisions.bottom=!0,e.player.airTime=0;return}}e.player.collisions.bottom=!1,e.player.airTime+=e.delta}}const d=new C,h=new P;h.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(h.domElement);let x=document.querySelector("canvas");const X=new _,Y=new I;var e;class H{constructor(){this.game=null,this.canvas=x,this.delta=0,this.server=null,this.connected=!1}init(){const t=new J;this.physics=t;const o=new j;this.camera=o.Camera();const a=new T;this.raycaster=a;const i=L("http://localhost:3069");this.server=i,this.world=new S,this.scene=d,d.add(this.camera),e.server.on("connect",()=>{console.log("connected"),e.connected=!0,e.server.emit("getWorld"),e.server.on("returnWorld",n=>{Y.create("@dev"),e.world.unpackWorldDataAndThenLoad(n)})}),g()}}document.addEventListener("DOMContentLoaded",()=>{e=new H,e.game=e,console.log(e),e.init()});document.addEventListener("keydown",s=>{let t=s.key.toUpperCase();if(t==="W"||t===" "){if(e.physics.gravityStrength===0)return;e.physics.gravityStrength=0,e.player.jump(),e.player.wannaJump=!0}t==="D"&&(e.player.facingDirection=new u(1,0,0),e.player.goingRight=!0),t==="A"&&(e.player.facingDirection=new u(-1,0,0),e.player.goingLeft=!0),t==="S"&&(e.player.position.y-=1),t==="X"&&(e.camera.zoomingOut=!0),t==="Z"&&(e.camera.zoomingIn=!0)});document.addEventListener("keyup",s=>{let t=s.key.toUpperCase();if((t==="W"||t===" ")&&(e.player.wannaJump=!1,e.player.hasJumped=!1,e.physics.gravityStrength=1,e.player.airTime=0),t==="P"){if(e.player.mouseButtonAction==="punch"){e.player.mouseButtonAction="place",console.log("place");return}if(e.player.mouseButtonAction==="place"){e.player.mouseButtonAction="punch",console.log("punch");return}}t==="D"&&(e.player.goingRight=!1),t==="A"&&(e.player.goingLeft=!1),t==="X"&&(e.camera.zoomingOut=!1),t==="Z"&&(e.camera.zoomingIn=!1)});x.addEventListener("pointermove",s=>{e.player!==void 0&&e.player.setMousePosition(s)});document.addEventListener("pointerdown",s=>{e.player!==void 0&&(e.player.holdingMouseRight=!0)});document.addEventListener("pointerup",s=>{e.player!==void 0&&(e.player.holdingMouseRight=!1)});function g(){if(e.delta=X.getDelta(),!e.world.isLoaded||e.player===void 0){requestAnimationFrame(g),h.render(d,e.camera);return}if(e.physics.update(),e.player.goingRight&&e.player.position.x<99.25&&e.player.moveRight(),e.player.goingLeft&&e.player.position.x>-.1&&e.player.moveLeft(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="punch"&&e.player.punch(),e.player.holdingMouseRight&&e.player.mouseButtonAction==="place"&&e.player.place(),e.player.wannaJump){if(e.player.canDoubleJump===!1&&e.player.hasTouchedGround===!1&&e.player.hasJumped===!0)return;e.player.jump()}e.camera.zoomingIn===!0&&(console.log(e.camera.position.z),e.camera.position.z>2&&(e.camera.position.z-=5*e.delta)),e.camera.zoomingOut===!0&&(console.log(e.camera.position.z),e.camera.position.z<12&&(e.camera.position.z+=5*e.delta)),e.camera.position.x=e.player.position.x,e.camera.position.y=e.player.position.y,e.player.sprite.position.x=e.player.position.x,e.player.sprite.position.y=e.player.position.y,e.player.standingOn(),requestAnimationFrame(g),h.render(d,e.camera)}
